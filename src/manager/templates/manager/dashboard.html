{% extends 'core/base.html' %}
{% load static %}
{% load custom_filters %}

{% block section %}Account Dashboard{% endblock %}

{% block content %}
	<h1 class="text-center">Account Dashboard</h1>

	<!-- Messages -->
	{% include 'core/messages.html' %}
	<!-- End Messages -->
	<!-- Announcements Display -->
	<div class="row justify-content-center">
		<div class="col">
			<div class="alert alert-dismissible fade show mt-3 mb-2 p-0 shadow-sm">
				{% for announcement in announcements %}
					<div class="card m-0 border-secondary">
						<div class="card-header font-weight-bold bg-secondary text-white">
							Recent Announcement
							<button type="button" class="close" data-dismiss="alert">&times;</button>
						</div>
						<div class="card-body">
							<h4 class="card-title mb-0">{{ announcement.title }}</h4>
							<small class="card-text text-muted">{{ announcement.author.first_name }} | {{ announcement.created_on}} </small>
							{% if announcement.created_on < announcement.updated_on %}
								<br>
								<small class="card-text text-muted">Updated on: {{ announcement.updated_on}} </small>
							{% endif %}
							{% if announcement.content|length > 140 %}
								<p class="card-text lead mt-2">{{announcement.content|slice:":140" }}...</p>
								<a href="{% url 'announcement_detail' announcement.slug  %}" class="btn btn-primary btn-sm">Read More</a>
							{% else %}
								<p class="card-text lead mt-2">{{ announcement.content }}</p>
							{% endif %}
						</div>
					</div>
				{% empty %}
					<div class="card m-0 border-secondary">
						<div class="card-header font-weight-bold bg-secondary text-white">
							Recent Announcement
							<button type="button" class="close" data-dismiss="alert">&times;</button>
						</div>
						<div class="card-body">
							<p class="lead">No announcements have been posted.</p>
						</div>
					</div>
				{% endfor %}
			</div>
		</div>
	</div>
	<!-- End Announcements Display -->
	<!-- User Card deck -->
	<div class="card-deck">
		<!-- Profile card -->
		<div class="card mt-4 border-secondary">
			<div class="card-header font-weight-bold bg-secondary text-white">
				Profile
				{% if lunch_form_url %}
				<a class="btn btn-sm btn-primary float-right" href="{{ lunch_form_url }}" target="_blank" rel="external"><i class="fa fa-file-text" aria-hidden="true"></i>
					Lunch Survey</a>
				{% endif %}
			</div>
			<div class="card-body overflow-auto">
				<ul class="list-group list-group-flush">
					<li class="list-group-item"><span class="font-weight-bolder">Name:</span> {{ user.get_full_name }}</li>
					<li class="list-group-item"><span class="font-weight-bolder">Email:</span> {{ user.email }}</li>
					{% if user.profile.fsu_id %}
						<li class="list-group-item"><span class="font-weight-bolder">FSU ID:</span> {{ user.profile.fsu_id }}</li>
					{% else %}
						<li class="list-group-item"><span class="font-weight-bolder">FSU ID:</span> <span class="text-danger">blank</span></li>
					{% endif %}
					{% if user.profile.fsu_num.id %}
						<li class="list-group-item"><span class="font-weight-bolder">FSU Number:</span> {{ user.profile.fsu_num.id|stringformat:"08d" }}</li>
					{% else %}
						<li class="list-group-item"><span class="font-weight-bolder">FSU Number:</span> <span class="text-danger">blank</span></li>
					{% endif %}
					{% if user.profile.checked_in %}
						<li class="list-group-item"><span class="font-weight-bolder">Checked-in:</span> Yes</li>
					{% else %}
						<li class="list-group-item"><span class="font-weight-bolder">Checked-in:</span> No</li>
					{% endif %}
					<li class="list-group-item"><span class="font-weight-bolder">Role:</span> {{ roles | return_item:user.profile.role }}</li>
				</ul>
			</div>
			<div class="card-footer">
				<a class="btn btn-info btn-sm" href="{% url 'manage_profile' %}" role="button">Edit</a>
			</div>
		</div>
		<!-- Profile card end -->
		<!-- Courses card -->
		<div class="card mt-4 border-secondary">
			<div class="card-header font-weight-bold bg-secondary text-white">
				Courses
			</div>
			<div class="card-body overflow-auto">
				{% if total_num_courses == 0 %}
					<p class="text-center">No courses have been confirmed at this time.</p>
				{% elif user.profile.fsu_id is None %}
					<p>Your FSU ID is blank. Please add it to your profile in order to add or edit your courses. </p>
				{% elif user.profile.has_courses %}
					<table class="table table-sm">
						<thead>
							<tr>
								<th scope="col">Code</th>
								<th scope="col">Name</th>
								<th scope="col">Instructor</th>
							</tr>
						</thead>
						<tbody>
							{% for course in courses %}
							<tr>
								<td>{{ course.code }}</td>
								<td>{{ course.name }}</td>
								<td>{{ course.instructor.last_name }}</td>
							</tr>
							{% endfor %}
						</tbody>
					</table>
				{% else %}
					<div class="row justify-content-center">
						<a class="btn btn-outline-info btn-sm" href="{% url 'manage_courses' %}" role="button">Add</a>
					</div>
				{% endif %}
			</div>
			<div class="card-footer">
				{% if user.profile.fsu_id is None or not user.profile.has_courses %}
					<a href="#" role="button" class="btn btn-info btn-sm disabled">Edit</a>
					<a href="#" role="button" class="btn btn-danger btn-sm disabled">Clear</a>
				{% else %}
					<a class="btn btn-info btn-sm" href="{% url 'manage_courses' %}" role="button">Edit</a>
					<button type="button" class="btn btn-danger btn-sm" data-toggle="modal"
						data-target="#confirmClearModal">Clear</button>
				{% endif %}
			</div>
		</div>
		<!-- Courses card end -->		
	</div>
	<!-- User Card deck end -->
	<!-- Team Card deck -->
	<div class="card-deck">
		<!-- Team card -->
		<div class="card mt-4 border-secondary">
			<div class="card-header font-weight-bold bg-secondary text-white">
				<span>Team</span>
			</div>
			<div class="card-body overflow-auto">
				{% if user.profile.has_team %}
					<ul class="list-group list-group-flush">
						<li class="list-group-item"><span class="font-weight-bolder">Name:</span> {{ user.profile.team.name }}</li>
						{% if user.profile.team.division == 1 %}
							<li class="list-group-item"><span class="font-weight-bolder">Division:</span> Upper</li>
						{% else %}
							<li class="list-group-item"><span class="font-weight-bolder">Division:</span> Lower</li>
						{% endif %}
						{% if user.profile.team_admin %}
							<li class="list-group-item"><span class="font-weight-bolder">Admin:</span> Yes</li>
							<li class="list-group-item"><span class="font-weight-bolder">PIN:</span> {{ user.profile.team.pin }}</li>
						{% else %}

							<li class="list-group-item"><span class="font-weight-bolder">Admin:</span> No</li>
						{% endif %}
						{% if user.profile.team.is_walkin %}
							<li class="list-group-item"><span class="font-weight-bolder">PIN:</span> {{ user.profile.team.pin }}</li>
						{% endif %}
						{% if user.profile.checked_in %}
							<li class="list-group-item"><span class="font-weight-bolder">DOMjudge Username:</span> {{ user.profile.team.contest_id }}</li>
							<li class="list-group-item"><span class="font-weight-bolder">DOMjudge Password:</span> {{ user.profile.team.contest_password }}</li>
						{% endif %}
					</ul>
				{% else %}
				<div class="row justify-content-center">
					<a class="btn btn-outline-info btn-sm" href="{% url 'join_team' %}" role="button">Join registered team</a>
				</div>
				<hr>
				<div class="row justify-content-center">
					<a class="btn btn-outline-info btn-sm" href="{% url 'register_team' %}" role="button">Create new team</a>
				</div>
				{% endif %}
			</div>
			<div class="card-footer">
				{% if user.profile.has_team %}
					{% if user.profile.team_admin %}
						<a class="btn btn-info btn-sm" href="{% url 'manage_team' %}" role="button">Manage</a>
						<button type="button" class="btn btn-warning btn-sm" data-toggle="modal" data-target="#confirmLeaveModal">Leave</button>
						<button type="button" class="btn btn-danger btn-sm" data-toggle="modal" data-target="#confirmDeleteModal">Delete</button>
					{% else %}
						<button type="button" class="btn btn-warning btn-sm" data-toggle="modal" data-target="#confirmLeaveModal">Leave</button>
					{% endif %}
				{% else %}
					<a href="#" role="button" class="btn btn-warning btn-sm disabled">Leave</a>
				{% endif %}
			</div>
		</div>
		<!-- Team card end -->
		<!-- Team Members card -->
		<div class="card mt-4 border-secondary">
			<div class="card-header font-weight-bold bg-secondary text-white">
				Team Members
			</div>
			<div class="card-body overflow-auto">
				{% if user.profile.has_team %}
					<table class="table table-sm">
						<thead>
							<tr>
								<th scope="col">First Name</th>
								<th scope="col">Last Name</th>
								<th scope="col" class="text-center">Checked-in</th>
							</tr>
						</thead>
						<tbody>
							{% for member in team_members %}
							<tr>
								<td>{{ member.first_name }}</td>
								<td>{{ member.last_name }}</td>
								{% if member.profile.checked_in %}
									<td class="text-center">Yes</td>
								{% else %}
									<td class="text-center">No</td>
								{% endif %}
							</tr>
							{% endfor %}
						</tbody>
					</table>
				{% else %}
				<div class="row justify-content-center">
					<a class="btn btn-outline-info btn-sm" href="{% url 'join_team' %}" role="button">Join registered team</a>
				</div>
				<hr>
				<div class="row justify-content-center">
					<a class="btn btn-outline-info btn-sm" href="{% url 'register_team' %}" role="button">Create new team</a>
				</div>
				{% endif %}
			</div>
		</div>
		<!-- Team Members card end -->
	</div>
	<!-- Team Card deck end --> 
	<!-- Confirm Clear Modal -->
	<div class="modal fade" id="confirmClearModal" tabindex="-1" role="dialog"
		aria-labelledby="confirmClearModalCenterTitle" aria-hidden="true">
		<div class="modal-dialog modal-dialog-centered" role="document">
			<div class="modal-content">
				<div class="modal-header">
					<h5 class="modal-title" id="confirmClearModalLongTitle">Clear courses</h5>
					<button type="button" class="close" data-dismiss="modal" aria-label="Close">
						<span aria-hidden="true">&times;</span>
					</button>
				</div>
				<div class="modal-body">
					<p>Are you sure you want to clear your courses?</p>
				</div>
				<div class="modal-footer">
					<a class="btn btn-primary" href="{% url 'clear_courses' %}" role="button">Confirm</a>
					<button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
				</div>
			</div>
		</div>
	</div>
	<!-- End Confirm Clear Modal -->
	<!-- Confirm Leave Modal -->
	<div class="modal fade" id="confirmLeaveModal" tabindex="-1" role="dialog"
		aria-labelledby="confirmLeaveModalCenterTitle" aria-hidden="true">
		<div class="modal-dialog modal-dialog-centered" role="document">
			<div class="modal-content">
				<div class="modal-header">
					<h5 class="modal-title" id="confirmLeaveModalLongTitle">Leave team</h5>
					<button type="button" class="close" data-dismiss="modal" aria-label="Close">
						<span aria-hidden="true">&times;</span>
					</button>
				</div>
				<div class="modal-body">
					<p>Are you sure you want to leave {{ request.user.profile.team.name }} ?</p>
				</div>
				<div class="modal-footer">
					<a class="btn btn-primary" href="{% url 'leave_team' %}" role="button">Confirm</a>
					<button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
				</div>
			</div>
		</div>
	</div>
	<!-- End Confirm Leave Modal -->
	<!-- Confirm Delete Modal -->
	<div class="modal fade" id="confirmDeleteModal" tabindex="-1" role="dialog"
		aria-labelledby="confirmDeleteModalCenterTitle" aria-hidden="true">
		<div class="modal-dialog modal-dialog-centered" role="document">
			<div class="modal-content">
				<div class="modal-header">
					<h5 class="modal-title" id="confirmDeleteModalLongTitle">Delete team</h5>
					<button type="button" class="close" data-dismiss="modal" aria-label="Close">
						<span aria-hidden="true">&times;</span>
					</button>
				</div>
				<div class="modal-body">
					<p>Are you sure you want to delete {{ request.user.profile.team.name }} ?</p>
				</div>
				<div class="modal-footer">
					<a class="btn btn-primary" href="{% url 'delete_team' %}" role="button">Confirm</a>
					<button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
				</div>
			</div>
		</div>
	</div>
	<!-- End Confirm Delete Modal -->
{% endblock %}